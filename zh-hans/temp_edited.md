

本测试使用的数据是由 tpch 程序产生的 lineitem 数据。我们将创建 100 张表（包含 16 个字段，9个索引），每张表包含 200 万条原始数据，大小为 1.2GB，共计 120GB 的原始数据。

## MyRocks on Terark

插入耗时 3.5 小时，插完并经过压缩后占用磁盘大小 35GB。使用32线程的测试程序，以下是查询统计，

| 内存限制*   |  QPS   | CPU 占用  | TPS(iostat) | kB_read(iostat) |
|----------:|-------:|---------:|------------:|----------------:|
| 不限内存   | 97,000 | 2400%    |  517        |  2,068          |
| 限制为 32G | 95,000 | 2400%    |  349        |  1,396          |
| 为 24G    | 78,000 | 2000%    |  17,000     |  68,104         |
| 为 16G    | 47,000 | 1400%    |  44,405     |  177,620        |
| 为 8G     | 28,000 | 900%     |  48,000     |  195,016        |

注*：TerarkDB 使用 mmap，所以这里使用了 cgroup 的方式进行内存限制。

## MyRocks on InnoDB

插入使用默认配置，插入 21 小时，插完并经过占用磁盘大小 210G 左右。使用32线程的测试程序，以下是查询统计，

| 内存限制*  |Buffer<br/>Pool|  QPS   | CPU 占用  | TPS(iostat) | kB_read(iostat) |
|----------:|---:|-------:|---------:|------------:|----------------:|
| 不限制     |96G | 47,000 |     900%|             |                 |
| 96G       |48G | 28,000 |      470%|  14,995     |  473,572        |
| 32G       |16G | 19,000 |      400%|  18,326     |  450,656        |
| 16G       | 8G | 14,500 |      350%|  19,076     |  438,828        |
|  8G       | 4G | 14,000 |      400%|  22,051     |  422,212        |
 
注* : 系统总计内存 188G，在不限内存的情况下，也不足以装下所有数据(210G)。限制内存时，因为 innodb 使用 pread/aio 读取数据，而 cgroup 无法限制操作系统 filesystem cache，所以通过操作系统启动参数进行内存限制。
